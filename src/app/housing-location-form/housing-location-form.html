<div class="container">
  <h2>Anadir nueva vivienda</h2>
  
  <!-- @if: control de flujo de template moderno para mostrar mensajes segun estado -->
  @if (successMsg) {
    <div class="alert alert-success">
      {{ successMsg }}
      <button type="button" class="close-btn" (click)="successMsg = ''">×</button>
    </div>
  }
  
  @if (errorMsg) {
    <div class="alert alert-error">
      {{ errorMsg }}
      <button type="button" class="close-btn" (click)="errorMsg = ''">×</button>
    </div>
  }

  <!-- [formGroup]: vincula template con FormGroup para validacion reactiva -->
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="form-row">
      <div class="form-group full-width">
        <label>Nombre / Titulo *</label>
        <!-- formControlName: enlaza cada input con su control del FormGroup para validacion -->
        <input 
          type="text" 
          formControlName="name"
          [class.invalid]="form.controls.name.touched && form.controls.name.invalid"
          placeholder="Ej: Acme Fresh Start Housing">
        @if (form.controls.name.touched && form.controls.name.invalid) {
          <div class="error-message">
            <!-- @if: comprobar errores especificos del control para mostrar mensajes detallados -->
            @if (form.controls.name.errors?.['required']) { Campo obligatorio }
            @if (form.controls.name.errors?.['minlength']) { Minimo 3 caracteres }
          </div>
        }
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Ciudad *</label>
        <input 
          type="text" 
          formControlName="city"
          [class.invalid]="form.controls.city.touched && form.controls.city.invalid"
          placeholder="Ej: Chicago">
        @if (form.controls.city.touched && form.controls.city.invalid) {
          <div class="error-message">Campo obligatorio</div>
        }
      </div>

      <div class="form-group">
        <label>Estado *</label>
        <input 
          type="text" 
          formControlName="state"
          [class.invalid]="form.controls.state.touched && form.controls.state.invalid"
          placeholder="Ej: IL">
        @if (form.controls.state.touched && form.controls.state.invalid) {
          <div class="error-message">Campo obligatorio</div>
        }
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Unidades disponibles *</label>
        <input 
          type="number" 
          formControlName="availableUnits"
          [class.invalid]="form.controls.availableUnits.touched && form.controls.availableUnits.invalid"
          min="1">
        @if (form.controls.availableUnits.touched && form.controls.availableUnits.invalid) {
          <div class="error-message">Minimo 1 unidad</div>
        }
      </div>

      <div class="form-group">
        <label>Precio *</label>
        <input 
          type="number" 
          formControlName="price"
          [class.invalid]="form.controls.price.touched && form.controls.price.invalid"
          min="10000">
        @if (form.controls.price.touched && form.controls.price.invalid) {
          <div class="error-message">Minimo $10,000</div>
        }
      </div>
    </div>

    <div class="form-row checkboxes">
      <div class="form-check">
        <input type="checkbox" id="wifi" formControlName="wifi">
        <label for="wifi">WiFi incluido</label>
      </div>

      <div class="form-check">
        <input type="checkbox" id="laundry" formControlName="laundry">
        <label for="laundry">Lavanderia disponible</label>
      </div>

      <div class="form-check">
        <input type="checkbox" id="available" formControlName="available">
        <label for="available">Disponible ahora</label>
      </div>
    </div>

    <div class="form-actions">
      <!-- [disabled]: deshabilita boton cuando la expresion es true para evitar envios invalidos -->
      <button type="submit" class="btn-primary" [disabled]="form.invalid || submitting">
        @if (submitting) {
          <span class="spinner"></span>
        }
        Guardar vivienda
      </button>
      <button type="button" class="btn-secondary" (click)="cancel()">
        Cancelar
      </button>
    </div>
  </form>
</div>